(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/getCards/getCards"],{2280:function(t,n,e){"use strict";(function(t){e("e525"),e("921b");o(e("66fd"));var n=o(e("2e5c"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},"2e5c":function(t,n,e){"use strict";e.r(n);var o=e("dad3"),r=e("65c7");for(var a in r)"default"!==a&&function(t){e.d(n,t,(function(){return r[t]}))}(a);e("fcce");var i,s=e("f0c5"),c=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);n["default"]=c.exports},"65c7":function(t,n,e){"use strict";e.r(n);var o=e("79a5"),r=e.n(o);for(var a in o)"default"!==a&&function(t){e.d(n,t,(function(){return o[t]}))}(a);n["default"]=r.a},"79a5":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=e("064b"),r=a(e("aa16"));a(e("4cf2"));function a(t){return t&&t.__esModule?t:{default:t}}var i={onShow:function(t){var n=this;this.color=this.BASECOLOR,this.ossDownloadUrl=this.HTTPCONFIG.ossDownloadUrl,this.COMMONFUNCTION.getStorageByKey(this.STORAGECONFIG.appData).then((function(t){n.cardId=t.cardType,n.saleAmt=t.saleAmt,n.queryVipCardInfo()}))},data:function(){return{openId:"",cardType:"",saleAmt:0,color:"",cardId:"",grpId:"",shopId:"",cardInfo:"",hasRegist:!1,hasGet:!1,ossDownloadUrl:"",disabled:r.default.status.disabled,used:r.default.status.used}},onPullDownRefresh:function(){this.queryVipCardInfo()},methods:{queryByRealScence:function(n){var e=n.split("-"),o=e[0];if(e.length>=2)var r=e[1];o?(this.cardId=o,r&&(this.shopId=r),this.queryVipCardInfo()):t.showToast({icon:"none",title:"获取会员卡信息错误"})},toDetail:function(t){this.COMMONFUNCTION.toPage(t)},getCard:function(){var t=this;this.saleAmt>0?(console.log("ok"),this.COMMONFUNCTION.getCode().then((function(n){(0,o.login)(n,t.grpId).then((function(n){t.pay(t.grpId,t.COMMONFUNCTION.getRandomMerchantTxnNumber(),t.saleAmt,n.custInfoList[0].openid)}))}))):(0,o.receive)(this.cardId,this.grpId,this.shopId).then((function(n){t.COMMONFUNCTION.redirectPage("/pages/mycards-and-coupon/mycards-and-coupon")})).catch((function(n){t.showError(n)}))},mpGetUserInfo:function(t){var n=this;if(this.hasRegist)this.getCard();else{if(!t.detail.userInfo)return void this.COMMONFUNCTION.toSetting("授权失败,请开启授权");this.COMMONFUNCTION.getCode().then((function(e){console.log("getCode");var r=t.detail.userInfo;(0,o.regist)(e,r.nickName,2,1,n.grpId,r.avatarUrl,n.shopId).then((function(t){console.log("register"),n.getCard()})).catch((function(t){n.showError(t)}))}))}},queryVipCardInfo:function(){var t=this;(0,o.vipQueryCardType)(this.cardId).then((function(n){t.cardInfo=n.cardType,t.grpId=n.cardType.grpCode,t.saleAmt=n.cardType.saleAmt,console.log(t.saleAmt,"this.saleAmt"),t.login()})).catch((function(n){t.showError(n)}))},login:function(){var n=this;this.COMMONFUNCTION.getCode().then((function(e){(0,o.login)(e,n.grpId).then((function(e){t.stopPullDownRefresh(),n.hasRegist=!0,(0,o.isReceive)(n.grpId).then((function(){n.hasGet=!1})).catch((function(t){t.rc===n.HTTPCONFIG.cantGetCard?n.hasGet=!0:n.showError(t)}))})).catch((function(e){t.stopPullDownRefresh(),e.rc&&e.rc===n.HTTPCONFIG.unRegist?n.hasRegist=!1:n.showError(e)}))}))},showError:function(t){t instanceof Object?this.$refs.notify.show(t.rcDetail,this.COLORCONFIG.danger):t instanceof String?this.$refs.notify.show(t,this.COLORCONFIG.danger):this.$refs.notify.show("未知错误",this.COLORCONFIG.danger)},userAgreement:function(){this.COMMONFUNCTION.toPage("/pages/about-content/userAgreement")},privAgreement:function(){this.COMMONFUNCTION.toPage("/pages/about-content/privacyAgreement")},pay:function(n,e,r,a){var i=this;(0,o.buyCard)(n,r,e,a).then((function(n){t.requestPayment({provider:"wxpay",timeStamp:n.ExtendInfo.timeStamp,nonceStr:n.ExtendInfo.nonceStr,package:n.ExtendInfo.package,signType:n.ExtendInfo.signType,paySign:n.ExtendInfo.paySign,success:function(t){console.log("success:"+JSON.stringify(t)),(0,o.receive)(i.cardId,i.grpId,i.shopId).then((function(t){i.COMMONFUNCTION.redirectPage("/pages/mycards-and-coupon/mycards-and-coupon")})).catch((function(t){i.showError(t)}))},fail:function(t){console.log("fail:"+JSON.stringify(t))}})})).catch((function(t){i.$refs.notify.show("支付失败"+t,i.COLORCONFIG.danger)}))}}};n.default=i}).call(this,e("543d")["default"])},dad3:function(t,n,e){"use strict";var o,r=function(){var t=this,n=t.$createElement;t._self._c},a=[];e.d(n,"b",(function(){return r})),e.d(n,"c",(function(){return a})),e.d(n,"a",(function(){return o}))},eb17:function(t,n,e){},fcce:function(t,n,e){"use strict";var o=e("eb17"),r=e.n(o);r.a}},[["2280","common/runtime","common/vendor"]]]);