(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/getCoupons/getCoupons"],{3781:function(t,e,n){"use strict";n.r(e);var o=n("6552"),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a},"57c8":function(t,e,n){"use strict";var o=n("e3d1"),i=n.n(o);i.a},6552:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n("064b"),i=r(n("4cf2"));function r(t){return t&&t.__esModule?t:{default:t}}var s={onLoad:function(e){var n=this;if(this.color=this.BASECOLOR,this.ossDownloadUrl=this.HTTPCONFIG.ossDownloadUrl,1!=e.from){var o=JSON.stringify(decodeURIComponent(e.q));o=o.substring(1,o.length-1);var r,s=o.split("?")[1];s&&(r=i.default.Decrypt(s),console.log(r)),r?this.queryByRealScene(r):t.showToast({icon:"none",title:"获取优惠券信息错误"})}else this.COMMONFUNCTION.getStorageByKey("qrCodeUrl").then((function(t){var e,o=t.split("?")[1];o&&(e=i.default.Decrypt(o),console.log(e)),n.queryByRealScene(e),n.COMMONFUNCTION.removeStorageByKey("qrCodeUrl")})).catch((function(e){t.showToast({icon:"none",title:"获取优惠券信息错误"})}))},data:function(){return{color:"",couponCode:"",shopId:"",grpId:"",coupon:"",hasRegist:!1,ossDownloadUrl:"",cantReceiveReason:"",canReceive:!0,ownType:""}},onPullDownRefresh:function(){this.listAllCouponByArgs()},methods:{queryByRealScene:function(e){var n=e.split("-"),o=n[0];if(n.length>=2)var i=n[1];o?(this.couponCode=o,i&&(this.shopId=i),this.listAllCouponByArgs()):t.showToast({icon:"none",title:"获取优惠券信息错误"})},toDetail:function(t){this.COMMONFUNCTION.toPage(t)},getCard:function(){var t=this;(0,o.receiveCoupon)(this.grpId,this.couponCode,this.shopId).then((function(e){t.COMMONFUNCTION.redirectPage("/pages/mycards-and-coupon/mycards-and-coupon")})).catch((function(e){t.showError(e)}))},mpGetUserInfo:function(t){var e=this;if(this.hasRegist)this.getCard();else{if(!t.detail.userInfo)return void this.COMMONFUNCTION.toSetting("授权失败,请开启授权");this.COMMONFUNCTION.getCode().then((function(n){var i=t.detail.userInfo;(0,o.regist)(n,i.nickName,1,e.ownType,e.grpId,i.avatarUrl,e.shopId).then((function(t){e.getCard()})).catch((function(t){e.showError(t)}))}))}},listAllCouponByArgs:function(){var t=this;(0,o.listAllCouponByArgs)(this.couponCode).then((function(e){t.coupon=e.data,t.grpId=e.data.grpCode,t.ownType=e.data.ownType,t.login()})).catch((function(e){t.$refs.notify.show(JSON.stringify(e),t.COLORCONFIG.danger)}))},login:function(){var e=this;this.COMMONFUNCTION.getCode().then((function(n){(0,o.login)(n,e.grpId,!0).then((function(n){t.stopPullDownRefresh(),e.hasRegist=!0,(0,o.isReceiveCoupon)(e.grpId,e.couponCode).then((function(){e.canReceive=!0})).catch((function(t){e.canReceive=!1,e.cantReceiveReason=t}))})).catch((function(t){t.rc&&t.rc===e.HTTPCONFIG.unRegist?e.hasRegist=!1:e.showError(t)}))}))},showError:function(t){t instanceof Object?this.$refs.notify.show(t.rcDetail,this.COLORCONFIG.danger):t instanceof String?this.$refs.notify.show(t,this.COLORCONFIG.danger):this.$refs.notify.show("未知错误",this.COLORCONFIG.danger)},userAgreement:function(){this.COMMONFUNCTION.toPage("/pages/about-content/userAgreement")},privAgreement:function(){this.COMMONFUNCTION.toPage("/pages/about-content/privacyAgreement")}}};e.default=s}).call(this,n("543d")["default"])},cb16:function(t,e,n){"use strict";n.r(e);var o=n("d647"),i=n("3781");for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("57c8");var s,c=n("f0c5"),a=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=a.exports},d647:function(t,e,n){"use strict";var o,i=function(){var t=this,e=t.$createElement,n=(t._self._c,t._f("expTimeFilter")(t.coupon.beginDate)),o=t._f("expTimeFilter")(t.coupon.expDate);t.$mp.data=Object.assign({},{$root:{f0:n,f1:o}})},r=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}))},e3d1:function(t,e,n){},fdba:function(t,e,n){"use strict";(function(t){n("e525"),n("921b");o(n("66fd"));var e=o(n("cb16"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["fdba","common/runtime","common/vendor"]]]);